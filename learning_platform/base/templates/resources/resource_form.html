{% extends 'base.html' %}
{% block title %}{{ form.instance.pk|yesno:"Modifier Ressource,Ajouter Ressource" }}{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
        <a href="{% url 'module-list-by-course' course.id %}?module_id={{ module.id }}"
            class="text-[#7C6B51] hover:text-[#A7AA63] text-sm mb-2 inline-flex items-center gap-1 transition-colors">
            <i class="fas fa-arrow-left"></i>
            Retour au module
        </a>
        <h1 class="text-3xl font-bold text-[#312B1E] flex items-center gap-3">
            <div
                class="w-12 h-12 rounded-xl bg-gradient-to-br from-[#A7AA63] to-[#E2CEAE] flex items-center justify-center">
                <i class="fas fa-file-alt text-[#121A1B]"></i>
            </div>
            {{ form.instance.pk|yesno:"Modifier la Ressource,Ajouter une Ressource" }}
        </h1>
    </div>

    <div class="bg-[#F2EFE4] p-8 rounded-2xl shadow-warm-md border border-[#C5B8A8]/30">
        {% if form.non_field_errors %}
        <div class="mb-6 p-4 bg-[#312B1E] text-[#EAE6D2] rounded-xl flex items-center gap-3">
            <i class="fas fa-exclamation-triangle text-[#E2CEAE]"></i>
            {{ form.non_field_errors }}
        </div>
        {% endif %}

        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}

            <!-- Title -->
            <div class="form-field">
                <label class="block text-sm font-semibold mb-2 text-[#505039]" for="{{ form.title.id_for_label }}">
                    <i class="fas fa-heading mr-1 text-[#A7AA63]"></i> Titre de la ressource <span
                        class="text-[#A7AA63]">*</span>
                </label>
                <input type="text" name="title" id="{{ form.title.id_for_label }}"
                    value="{{ form.title.value|default:'' }}" class="w-full px-4 py-3 rounded-xl"
                    placeholder="Titre de la ressource" required>
                {% for error in form.title.errors %}
                <p class="text-[#312B1E] text-sm mt-1 flex items-center gap-1">
                    <i class="fas fa-exclamation-triangle text-[#7C6B51]"></i>{{ error }}
                </p>
                {% endfor %}
            </div>

            <!-- Resource Type -->
            <div class="form-field">
                <label class="block text-sm font-semibold mb-2 text-[#505039]"
                    for="{{ form.resource_type.id_for_label }}">
                    <i class="fas fa-tag mr-1 text-[#A7AA63]"></i> Type
                </label>
                <select name="resource_type" id="{{ form.resource_type.id_for_label }}"
                    class="w-full px-4 py-3 rounded-xl">
                    <option value="video" {% if form.resource_type.value == 'video' %}selected{% endif %}>Vidéo</option>
                    <option value="pdf" {% if form.resource_type.value == 'pdf' %}selected{% endif %}>PDF</option>
                    <option value="image" {% if form.resource_type.value == 'image' %}selected{% endif %}>Image</option>
                    <option value="fichier" {% if form.resource_type.value == 'fichier' %}selected{% endif %}>Fichier
                    </option>
                </select>
            </div>

            <!-- Source Card -->
            <div class="bg-[#EAE6D2] rounded-xl border border-[#C5B8A8]/50 overflow-hidden">
                <div class="bg-gradient-to-r from-[#312B1E] to-[#505039] text-[#EAE6D2] px-5 py-3 font-medium">
                    <i class="fas fa-cloud-upload-alt mr-2"></i>Source de la ressource
                </div>
                <div class="p-5 space-y-5">
                    <!-- File Upload -->
                    <div class="form-field">
                        <label class="block text-sm font-semibold mb-2 text-[#505039]"
                            for="{{ form.file.id_for_label }}">
                            <i class="fas fa-upload mr-1 text-[#A7AA63]"></i> Importer depuis votre PC
                        </label>
                        <input type="file" name="file" id="{{ form.file.id_for_label }}"
                            class="w-full px-4 py-3 bg-[#F2EFE4] rounded-xl border border-[#C5B8A8]/50 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-[#A7AA63] file:text-[#FFFFFF] hover:file:bg-[#8e9150] file:cursor-pointer file:transition-colors">
                        <p class="text-[#7C6B51] text-sm mt-2">
                            <i class="fas fa-info-circle mr-1"></i>Tous formats acceptés (max 50 MB)
                        </p>
                        {% if form.instance.file %}
                        <p class="text-[#A7AA63] text-sm mt-1 flex items-center gap-1">
                            <i class="fas fa-check-circle"></i>Fichier actuel: {{ form.instance.file.name }}
                        </p>
                        {% endif %}
                    </div>

                    <!-- Separator -->
                    <div class="flex items-center gap-4">
                        <div class="flex-1 h-px bg-[#C5B8A8]/50"></div>
                        <span class="text-[#7C6B51] text-sm">ou</span>
                        <div class="flex-1 h-px bg-[#C5B8A8]/50"></div>
                    </div>

                    <!-- URL -->
                    <div class="form-field">
                        <label class="block text-sm font-semibold mb-2 text-[#505039]"
                            for="{{ form.url.id_for_label }}">
                            <i class="fas fa-link mr-1 text-[#A7AA63]"></i> URL de la ressource
                        </label>
                        <input type="url" name="url" id="{{ form.url.id_for_label }}"
                            value="{{ form.url.value|default:'' }}" class="w-full px-4 py-3 rounded-xl"
                            placeholder="https://youtube.com/watch?v=... ou https://drive.google.com/...">
                        <p class="text-[#7C6B51] text-sm mt-2">
                            <i class="fas fa-exclamation-triangle mr-1"></i>Si vous importez un fichier, l'URL sera
                            ignorée.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Buttons -->
            <div class="flex items-center gap-4 pt-6 border-t border-[#C5B8A8]/30">
                <button type="submit" class="btn-primary">
                    <i class="fas fa-save"></i>
                    Enregistrer
                </button>
                <a href="{% url 'module-list-by-course' course.id %}?module_id={{ module.id }}" class="btn-secondary">
                    Annuler
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}