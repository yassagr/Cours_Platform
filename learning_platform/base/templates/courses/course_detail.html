{% extends 'base.html' %}
{% block title %}{{ course.title }}{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- Breadcrumb -->
    <nav class="flex items-center gap-2 text-sm text-[#7C6B51] mb-6">
        <a href="{% url 'course-list' %}" class="hover:text-[#A7AA63] transition-colors">Cours</a>
        <i class="fas fa-chevron-right text-xs"></i>
        <span class="text-[#312B1E] font-medium">{{ course.title }}</span>
    </nav>

    <!-- Hero Card -->
    <div class="bg-[#F2EFE4] rounded-2xl shadow-warm-lg border border-[#C5B8A8]/30 overflow-hidden mb-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-0">
            <!-- Image Column -->
            <div class="relative flex items-center justify-center" style="min-height: 10cm;">
                <div style="width: 14cm; height: 10cm;" class="relative overflow-hidden rounded-2xl shadow-2xl group">
                    {% if course.image %}
                    <img src="{{ course.image.url }}" alt="{{ course.title }}"
                        class="w-full h-full object-cover transition-transform duration-700 hover:scale-110">
                    {% else %}
                    <div
                        class="w-full h-full bg-gradient-to-br from-[#505039] to-[#312B1E] flex items-center justify-center">
                        <i class="fas fa-book text-8xl text-[#FFFFFF]/20"></i>
                    </div>
                    {% endif %}


                    <!-- Level badge -->
                    <div
                        class="absolute top-4 left-4 px-4 py-2 rounded-full text-sm font-semibold
                                bg-[#EAE6D2]/95 backdrop-blur-sm text-[#312B1E] shadow-warm-sm border border-[#C5B8A8]/30">
                        <i class="fas fa-signal mr-2 text-[#A7AA63]"></i>{{ course.level }}
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="p-8 flex flex-col justify-between">
                <div>
                    <h1 class="text-3xl lg:text-4xl font-extrabold text-[#312B1E] mb-4 leading-tight">
                        {{ course.title }}
                    </h1>

                    <!-- Meta info -->
                    <div class="flex flex-wrap gap-4 text-sm text-[#505039] mb-6">
                        <span class="flex items-center gap-2">
                            <div
                                class="w-8 h-8 rounded-full bg-gradient-to-br from-[#A7AA63] to-[#E2CEAE] flex items-center justify-center text-xs font-bold text-[#312B1E]">
                                {{ course.instructor.username|first|upper }}
                            </div>
                            {{ course.instructor.username }}
                        </span>
                        <span class="flex items-center gap-2">
                            <i class="fas fa-clock text-[#A7AA63]"></i>
                            {{ course.estimated_duration }}h
                        </span>
                        <span class="flex items-center gap-2">
                            <i class="fas fa-layer-group text-[#A7AA63]"></i>
                            {{ course.modules.count }} modules
                        </span>
                        <span class="flex items-center gap-2">
                            <i class="fas fa-users text-[#A7AA63]"></i>
                            {{ course.enrollments.count }} inscrits
                        </span>
                    </div>
                </div>

                <!-- Actions -->
                {% if user.is_authenticated %}
                <div class="flex flex-wrap gap-3">
                    {% if user.is_staff or user.role == 'Admin' or course.instructor == user %}
                    <a href="{% url 'course-update' course.pk %}" class="btn-secondary">
                        <i class="fas fa-edit"></i>
                        Modifier
                    </a>
                    <button type="button" class="btn-danger delete-trigger"
                        data-delete-url="{% url 'course-delete' course.pk %}"
                        data-item-title="{{ course.title|escapejs }}">
                        <i class="fas fa-trash"></i>
                        Supprimer
                    </button>
                    {% elif user.role == 'Student' %}
                    {% if already_enrolled %}
                    <a href="{% url 'module-list-by-course' course.pk %}" class="btn-primary">
                        <i class="fas fa-play"></i>
                        Continuer le cours
                    </a>
                    <form action="{% url 'unenroll' course.pk %}" method="post" class="inline">
                        {% csrf_token %}
                        <button type="submit" class="btn-danger">
                            <i class="fas fa-times-circle"></i>
                            Se désinscrire
                        </button>
                    </form>
                    <span
                        class="flex items-center gap-2 px-4 py-2 bg-[#A7AA63]/10 text-[#A7AA63] rounded-lg font-medium">
                        <i class="fas fa-check-circle"></i>
                        Inscrit
                    </span>
                    {% else %}
                    <form action="{% url 'enroll' course.pk %}" method="post" class="inline">
                        {% csrf_token %}
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-graduation-cap"></i>
                            S'inscrire à ce cours
                        </button>
                    </form>
                    {% endif %}
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Two Column Layout -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-8">
            <!-- Description -->
            <div class="bg-[#F2EFE4] rounded-2xl p-8 border border-[#C5B8A8]/30 shadow-warm-sm">
                <h2 class="text-2xl font-bold text-[#312B1E] mb-4 flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-xl bg-gradient-to-br from-[#A7AA63] to-[#E2CEAE] flex items-center justify-center">
                        <i class="fas fa-info-circle text-[#121A1B]"></i>
                    </div>
                    Description
                </h2>
                <p class="text-[#505039] leading-relaxed whitespace-pre-wrap">{{ course.description }}</p>
            </div>

            <!-- Modules List -->
            <div class="bg-[#F2EFE4] rounded-2xl p-8 border border-[#C5B8A8]/30 shadow-warm-sm">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-[#312B1E] flex items-center gap-3">
                        <div
                            class="w-10 h-10 rounded-xl bg-gradient-to-br from-[#505039] to-[#7C6B51] flex items-center justify-center">
                            <i class="fas fa-folder text-[#FFFFFF]"></i>
                        </div>
                        Contenu du cours
                    </h2>
                    <a href="{% url 'module-list-by-course' course.id %}"
                        class="text-[#A7AA63] hover:text-[#8e9150] font-medium transition-colors">
                        Voir tout <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>

                {% if modules %}
                <ul class="space-y-3">
                    {% for module in modules %}
                    <li>
                        <a href="{% url 'module-list-by-course' course.id %}?module_id={{ module.id }}"
                            class="flex items-center gap-4 p-4 rounded-xl bg-[#EAE6D2] hover:bg-[#E2CEAE] border border-[#C5B8A8]/30 hover:border-[#A7AA63] transition-all duration-300 group">
                            <div
                                class="w-10 h-10 rounded-lg bg-[#F2EFE4] border border-[#C5B8A8]/50 flex items-center justify-center text-[#7C6B51] group-hover:text-[#A7AA63] transition-colors">
                                <i class="fas fa-play"></i>
                            </div>
                            <div class="flex-1">
                                <span
                                    class="text-[#312B1E] font-medium group-hover:text-[#A7AA63] transition-colors">{{module.title
                                    }}</span>
                            </div>
                            <i
                                class="fas fa-chevron-right text-[#C5B8A8] group-hover:text-[#A7AA63] transition-colors"></i>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <div class="text-center py-12 bg-[#EAE6D2] rounded-xl border border-[#C5B8A8]/30">
                    <i class="fas fa-folder-open text-4xl text-[#C5B8A8] mb-4"></i>
                    <p class="text-[#7C6B51]">Aucun module pour ce cours pour l'instant.</p>
                </div>
                {% endif %}

                {% if user.is_staff or user.role == 'Admin' or course.instructor == user %}
                <div class="mt-6">
                    <a href="{% url 'module-create' course.id %}" class="btn-primary w-full justify-center">
                        <i class="fas fa-plus"></i>
                        Ajouter un module
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Course Stats Card -->
            <div class="bg-[#F2EFE4] rounded-2xl p-6 border border-[#C5B8A8]/30 shadow-warm-sm">
                <h3 class="text-lg font-bold text-[#312B1E] mb-4">Informations</h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-between py-3 border-b border-[#C5B8A8]/30">
                        <span class="text-[#7C6B51]">Durée estimée</span>
                        <span class="font-semibold text-[#312B1E]">{{ course.estimated_duration }}h</span>
                    </div>
                    <div class="flex items-center justify-between py-3 border-b border-[#C5B8A8]/30">
                        <span class="text-[#7C6B51]">Modules</span>
                        <span class="font-semibold text-[#312B1E]">{{ course.modules.count }}</span>
                    </div>
                    <div class="flex items-center justify-between py-3 border-b border-[#C5B8A8]/30">
                        <span class="text-[#7C6B51]">Inscrits</span>
                        <span class="font-semibold text-[#312B1E]">{{ course.enrollments.count }}</span>
                    </div>
                    <div class="flex items-center justify-between py-3">
                        <span class="text-[#7C6B51]">Niveau</span>
                        <span class="px-3 py-1 rounded-full text-xs font-semibold bg-[#A7AA63]/10 text-[#A7AA63]">
                            {{ course.level }}
                        </span>
                    </div>
                </div>
            </div>

            <!-- Instructor Card -->
            <div class="bg-[#F2EFE4] rounded-2xl p-6 border border-[#C5B8A8]/30 shadow-warm-sm">
                <h3 class="text-lg font-bold text-[#312B1E] mb-4">Instructeur</h3>
                <div class="flex items-center gap-4">
                    <div
                        class="w-14 h-14 rounded-full bg-gradient-to-br from-[#A7AA63] to-[#E2CEAE] flex items-center justify-center text-xl font-bold text-[#312B1E] shadow-warm-sm">
                        {{ course.instructor.username|first|upper }}
                    </div>
                    <div>
                        <p class="font-semibold text-[#312B1E]">{{ course.instructor.username }}</p>
                        <p class="text-sm text-[#7C6B51]">{{ course.instructor.email }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}